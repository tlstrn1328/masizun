<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>מחשבון מס איזון</title>
    <script defer>
      document.addEventListener('DOMContentLoaded', function () {
        const incomeInput = document.getElementById('income');
        const childrenUnder4 = document.getElementById('kids-under-4');
        const childrenOver4 = document.getElementById('kids-over-4');
        const familyStatus = document.getElementById('status');
        const result = document.getElementById('result');
        const form = document.getElementById('form');
        const spinner = document.getElementById('spinner');

        // Format income input
        incomeInput.addEventListener('input', function (e) {
          const raw = e.target.value.replace(/[^\d]/g, '');
          const formatted = Number(raw).toLocaleString('he-IL');
          e.target.value = formatted;
          if (formatted.length > 0) {
            setTimeout(() => childrenUnder4.focus(), 100);
          }
        });

        childrenUnder4.addEventListener('input', () => {
          setTimeout(() => childrenOver4.focus(), 100);
        });

        childrenOver4.addEventListener('input', () => {
          setTimeout(() => familyStatus.focus(), 100);
        });

        form.addEventListener('submit', function (e) {
          e.preventDefault();
          spinner.style.display = 'block';
          result.innerHTML = '';

          setTimeout(() => {
            spinner.style.display = 'none';
            const income = parseInt(incomeInput.value.replace(/,/g, '')) || 0;
            const kidsUnder = parseInt(childrenUnder4.value) || 0;
            const kidsOver = parseInt(childrenOver4.value) || 0;
            const isSingle = familyStatus.value === 'יחיד/ה';

            let yearlyCap = isSingle ? 6000 : 12000;
            let childDiscount = kidsUnder * 500 + kidsOver * 250;
            let totalTax = Math.max(0, yearlyCap - childDiscount);
            let monthly = Math.round(totalTax / 12);

            result.innerHTML = `מס איזון משוער: <strong>${monthly.toLocaleString('he-IL')} ₪</strong> לחודש`;
          }, 800); // Simulated load
        });
      });
    </script>
    <style>
      body {
        font-family: sans-serif;
        background: #f9f9f9;
        max-width: 600px;
        margin: auto;
        padding: 2rem;
      }
      h1 {
        color: #0077cc;
        font-size: 2rem;
      }
      label {
        display: block;
        margin-top: 1rem;
      }
      input, select, button {
        width: 100%;
        padding: 0.5rem;
        margin-top: 0.5rem;
        font-size: 1rem;
      }
      #spinner {
        display: none;
        text-align: center;
        padding: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>מחשבון מס איזון</h1>
    <p>סימולציה לחישוב מס איזון חודשי לחברי קהילת קיבוץ גבעת חיים מאוחד</p>
    <form id="form">
      <label>
        הכנסה חודשית (נטו):
        <input id="income" inputmode="decimal" autocomplete="off" />
      </label>
      <label>
        סטטוס בית אב:
        <select id="status">
          <option>יחיד/ה</option>
          <option>זוג</option>
        </select>
      </label>
      <label>
        ילדים עד גיל 4:
        <input id="kids-under-4" inputmode="numeric" />
      </label>
      <label>
        ילדים מעל גיל 4:
        <input id="kids-over-4" inputmode="numeric" />
      </label>
      <button type="submit">חשב מס איזון</button>
    </form>
    <div id="spinner">⏳ מחשב...</div>
    <p id="result"></p>
    <hr />
    <p><strong>לצפייה בתקנון מס איזון:</strong> <a href="mas-izun-takanon.pdf" target="_blank">תקנון מס איזון</a></p>
    <p><strong>לצפייה בהחלטת ההכנסה הפטורה לשנת 2025 (עמוד 19):</strong> <a href="https://www.kghm.co.il/login.asp?lastURL=/forum/forum/start.asp?msgID=1228063&forumID=42743" target="_blank">חוברת תקציב 2025</a></p>
    <p style="font-size: 0.8rem; color: gray;">⚠️ כל החישובים הם בגדר סימולציה בלבד. אין להסתמך עליהם לצורך קבלת החלטות כספיות או משפטיות.</p>
  </body>
</html>
